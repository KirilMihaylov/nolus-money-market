name: "Build optimized"
run-name: "Building optimized version of smart contracts"

on:
  workflow_call:

jobs:
  generate_release_version:
    runs-on: "ubuntu-latest"
    outputs:
      release_version: "${{ steps.release_version.outputs.release_version }}"
    steps:
      - id: "release_version"
        shell: "sh"
        run: |
          release_version="${{ github.ref_name }}-$(date -Iminute)"

          echo "release_version=${release_version}" >> "$GITHUB_OUTPUT"

          echo "Release version: ${release_version}" >> "${GITHUB_STEP_SUMMARY}"
  build_optimized_platform_contracts:
    needs: "generate_release_version"
    uses: "./.github/workflows/build_optimized_platform.yaml"
    with:
      release_version: "${{ needs.generate_release_version.outputs.release_version }}"
  build_optimized_protocol_contracts_osmosis:
    needs: "generate_release_version"
    uses: "./.github/workflows/build_optimized_protocol.yaml"
    with:
      target_dex: "osmosis"
      release_version: "${{ needs.generate_release_version.outputs.release_version }}"
